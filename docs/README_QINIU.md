# æ–‡ç”Ÿæ¼«ç”»è§†é¢‘å·¥å…· - ä¸ƒç‰›äº‘ç‰ˆæœ¬

## æ–°ç‰¹æ€§ ğŸ‰

- âœ… **æ— éœ€æœ¬åœ°GPU** - ä½¿ç”¨ä¸ƒç‰›äº‘APIç›´æ¥ç”Ÿæˆè§†é¢‘
- âœ… **æ›´å¿«é€Ÿ** - 5-15åˆ†é’Ÿç”Ÿæˆè§†é¢‘(vs. åŸæ¥çš„10-30åˆ†é’Ÿ)
- âœ… **æ›´ç®€å•** - æ— éœ€å®‰è£…Stable Diffusion
- âœ… **æ›´ç¨³å®š** - äº‘ç«¯æœåŠ¡,7x24å°æ—¶å¯ç”¨
- âœ… **åŒæ¨¡å¼** - æ”¯æŒä¸ƒç‰›äº‘å’Œæœ¬åœ°SDä¸¤ç§æ¨¡å¼

## å¿«é€Ÿå¼€å§‹(ä¸ƒç‰›äº‘æ¨¡å¼)

### å‰ç½®è¦æ±‚

- Go 1.21+
- OpenAI API Key (ç”¨äºå‰§æœ¬è§£æ)
- ä¸ƒç‰›äº‘API Key (ç”¨äºè§†é¢‘ç”Ÿæˆ)

### 1. å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/Jancd/1504.git
cd 1504
```

### 2. é…ç½®APIå¯†é’¥

ç¼–è¾‘ `configs/config.yaml`:

```yaml
openai:
  api_key: "your-openai-api-key"
  base_url: "https://openai.qiniu.com"  # å¦‚æœä½¿ç”¨ä¸ƒç‰›äº‘OpenAIä»£ç†

video_generation:
  type: "qiniu"  # ä½¿ç”¨ä¸ƒç‰›äº‘æ¨¡å¼
  qiniu:
    api_url: "https://api.qiniu.com/v1/video/generate"
    api_key: "your-qiniu-api-key"
```

**æ³¨æ„**: ä¸ƒç‰›äº‘çš„å®é™…APIç«¯ç‚¹è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£æ›´æ–°ã€‚

### 3. è¿è¡ŒæœåŠ¡

```bash
# æ–¹å¼1: å¼€å‘æ¨¡å¼
make dev

# æ–¹å¼2: ç¼–è¯‘è¿è¡Œ
make build
./bin/video-generator
```

### 4. ç”Ÿæˆè§†é¢‘

```bash
curl -X POST http://localhost:8080/api/generate \
  -H "Content-Type: application/json" \
  -d '{
    "text": "åœºæ™¯:æ¨±èŠ±é£˜è½çš„æ ¡å›­ã€‚å°æ¨±èµ°åœ¨è·¯ä¸Š,é‡åˆ°äº†å¿ƒä»ªçš„å­¦é•¿ã€‚ä¸¤äººçš„ç›®å…‰ç›¸é‡,æ—¶é—´ä»¿ä½›é™æ­¢äº†ã€‚",
    "options": {
      "duration_target": 20
    }
  }'
```

å“åº”:
```json
{
  "code": 0,
  "data": {
    "task_id": "xxx-xxx-xxx",
    "status": "processing"
  }
}
```

### 5. æŸ¥çœ‹è¿›åº¦

```bash
curl http://localhost:8080/api/tasks/{task_id}
```

### 6. ä¸‹è½½è§†é¢‘

```bash
curl http://localhost:8080/api/download/{task_id} -o output.mp4
```

## é…ç½®è¯´æ˜

### è§†é¢‘ç”Ÿæˆæ¨¡å¼

ç³»ç»Ÿæ”¯æŒä¸¤ç§æ¨¡å¼,åœ¨ `configs/config.yaml` ä¸­é…ç½®:

#### æ¨¡å¼1: ä¸ƒç‰›äº‘(æ¨è,æ— éœ€GPU)

```yaml
video_generation:
  type: "qiniu"
  qiniu:
    api_url: "https://api.qiniu.com/v1/video/generate"
    api_key: "your-api-key"
    timeout: 600
    max_wait_time: 600
```

#### æ¨¡å¼2: æœ¬åœ°Stable Diffusion(éœ€è¦GPU)

```yaml
video_generation:
  type: "local_sd"
  local_sd:
    api_url: "http://127.0.0.1:7860"
    timeout: 300
```

## ç³»ç»Ÿæ¶æ„

### ä¸ƒç‰›äº‘æ¨¡å¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·è¾“å…¥    â”‚ å°è¯´æ–‡æœ¬
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OpenAI GPT  â”‚ å‰§æœ¬è§£æ + åˆ†é•œç”Ÿæˆ
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸ƒç‰›äº‘API  â”‚ ç›´æ¥ç”Ÿæˆè§†é¢‘
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸‹è½½è§†é¢‘    â”‚ ä¿å­˜åˆ°æœ¬åœ°
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¿”å›ç”¨æˆ·    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æˆæœ¬å¯¹æ¯”

### ä¸ƒç‰›äº‘æ¨¡å¼
- OpenAI API: ~Â¥0.5/è§†é¢‘
- ä¸ƒç‰›äº‘è§†é¢‘ç”Ÿæˆ: æ ¹æ®å®šä»·(è¯·å’¨è¯¢ä¸ƒç‰›äº‘)
- æœåŠ¡å™¨: å¯ä½¿ç”¨ä½é…ç½®æœåŠ¡å™¨

### æœ¬åœ°SDæ¨¡å¼
- OpenAI API: ~Â¥0.5/è§†é¢‘
- æœ¬åœ°GPU: å…è´¹(ä½†éœ€è¦ç¡¬ä»¶æŠ•èµ„)
- ç”µè´¹: ~Â¥0.2/è§†é¢‘

## æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | ä¸ƒç‰›äº‘æ¨¡å¼ | æœ¬åœ°SDæ¨¡å¼ |
|------|-----------|-----------|
| å¤„ç†æ—¶é—´ | 5-15åˆ†é’Ÿ | 10-30åˆ†é’Ÿ |
| GPUè¦æ±‚ | âŒ ä¸éœ€è¦ | âœ… RTX 3060+ |
| ç¨³å®šæ€§ | â­â­â­â­â­ | â­â­â­ |
| å¯æ‰©å±•æ€§ | â­â­â­â­â­ | â­â­ |
| æˆæœ¬ | æŒ‰é‡ä»˜è´¹ | å›ºå®šæˆæœ¬ |

## APIæ–‡æ¡£

### åˆ›å»ºç”Ÿæˆä»»åŠ¡

```http
POST /api/generate
Content-Type: application/json

{
  "text": "å°è¯´æ–‡æœ¬å†…å®¹...",
  "options": {
    "style": "anime",
    "duration_target": 60,
    "aspect_ratio": "16:9"
  }
}
```

### æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€

```http
GET /api/tasks/{task_id}
```

å“åº”:
```json
{
  "code": 0,
  "data": {
    "task_id": "xxx",
    "status": "processing",
    "progress": 45,
    "current_step": "generate_images",
    "steps": [...]
  }
}
```

### ä¸‹è½½è§†é¢‘

```http
GET /api/download/{task_id}
```

## å¸¸è§é—®é¢˜

### Q: å¦‚ä½•è·å–ä¸ƒç‰›äº‘API Key?

A:
1. æ³¨å†Œä¸ƒç‰›äº‘è´¦å·
2. è®¿é—®æ–‡ç”Ÿè§†é¢‘APIæ–‡æ¡£
3. ç”³è¯·APIè®¿é—®æƒé™
4. è·å–API Key

### Q: ä¸ƒç‰›äº‘æ¨¡å¼ä¸‹æ˜¯å¦è¿˜éœ€è¦FFmpeg?

A: ä¸éœ€è¦ã€‚ä¸ƒç‰›äº‘ç›´æ¥ç”Ÿæˆå®Œæ•´è§†é¢‘,æ— éœ€æœ¬åœ°æ¸²æŸ“ã€‚ä½†å¦‚æœè¦åˆ‡æ¢åˆ°æœ¬åœ°SDæ¨¡å¼,ä»éœ€è¦FFmpegã€‚

### Q: å¯ä»¥åŒæ—¶ä½¿ç”¨ä¸¤ç§æ¨¡å¼å—?

A: å¯ä»¥é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶åˆ‡æ¢,ä½†åŒä¸€æ—¶é—´åªèƒ½ä½¿ç”¨ä¸€ç§æ¨¡å¼ã€‚

### Q: ä¸ƒç‰›äº‘ç”Ÿæˆçš„è§†é¢‘è´¨é‡å¦‚ä½•?

A: ä¸ƒç‰›äº‘ä½¿ç”¨ä¸“ä¸šçš„è§†é¢‘ç”Ÿæˆæ¨¡å‹,è´¨é‡ç¨³å®šå¯é ã€‚å…·ä½“æ•ˆæœå–å†³äºè¾“å…¥çš„æ–‡æœ¬è´¨é‡ã€‚

### Q: å¦‚ä½•è°ƒè¯•ä¸ƒç‰›äº‘APIè°ƒç”¨?

A:
1. è®¾ç½®æ—¥å¿—çº§åˆ«ä¸ºdebug
2. æŸ¥çœ‹æ—¥å¿—è¾“å‡º
3. ä½¿ç”¨curlç›´æ¥æµ‹è¯•API

```yaml
log:
  level: "debug"
```

## æ•…éšœæ’æŸ¥

### 1. ä¸ƒç‰›äº‘APIè¿æ¥å¤±è´¥

```
é”™è¯¯: Qiniu Video API health check failed
```

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥APIç«¯ç‚¹URLæ˜¯å¦æ­£ç¡®
- ç¡®è®¤API Keyæœ‰æ•ˆ
- æµ‹è¯•ç½‘ç»œè¿æ¥
- æŸ¥çœ‹ä¸ƒç‰›äº‘æœåŠ¡çŠ¶æ€

### 2. è§†é¢‘ç”Ÿæˆè¶…æ—¶

```
é”™è¯¯: timeout waiting for video generation
```

**è§£å†³æ–¹æ¡ˆ**:
```yaml
qiniu:
  max_wait_time: 1200  # å¢åŠ åˆ°20åˆ†é’Ÿ
```

### 3. OpenAIè°ƒç”¨å¤±è´¥

```
é”™è¯¯: openai api call failed
```

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥OpenAI API Key
- ç¡®è®¤base_urlé…ç½®æ­£ç¡®
- æ£€æŸ¥è´¦æˆ·ä½™é¢

## éƒ¨ç½²å»ºè®®

### å¼€å‘ç¯å¢ƒ
```bash
# æœ¬åœ°å¼€å‘
make dev
```

### ç”Ÿäº§ç¯å¢ƒ
```bash
# Dockeréƒ¨ç½²
docker build -t video-generator .
docker run -p 8080:8080 \
  -e OPENAI_API_KEY="your-key" \
  -e QINIU_API_KEY="your-key" \
  video-generator

# æˆ–ç›´æ¥è¿è¡Œ
make build
./bin/video-generator
```

## ç¯å¢ƒå˜é‡

```bash
# OpenAIé…ç½®
export OPENAI_API_KEY="your-openai-key"

# ä¸ƒç‰›äº‘é…ç½®
export QINIU_API_KEY="your-qiniu-key"

# æœåŠ¡å™¨é…ç½®
export SERVER_PORT=8080
export SERVER_MODE=release
```

## é™åˆ¶

å½“å‰ç‰ˆæœ¬é™åˆ¶:
- å•ä»»åŠ¡å¤„ç†(ä¸²è¡Œ)
- æœ€å¤§è§†é¢‘æ—¶é•¿: 120ç§’
- æœ€å¤§æ–‡æœ¬é•¿åº¦: 2000å­—
- æœ€å¤§é•œå¤´æ•°: 20ä¸ª

## å‡çº§è·¯å¾„

ä»æœ¬åœ°SDæ¨¡å¼å‡çº§åˆ°ä¸ƒç‰›äº‘æ¨¡å¼:

1. æ›´æ–°é…ç½®:
```yaml
video_generation:
  type: "qiniu"  # æ”¹ä¸ºqiniu
```

2. æ·»åŠ ä¸ƒç‰›äº‘é…ç½®
3. é‡å¯æœåŠ¡
4. æµ‹è¯•æ¥å£

æ— éœ€ä¿®æ”¹ä»£ç ,ç³»ç»Ÿä¼šè‡ªåŠ¨é€‰æ‹©å¯¹åº”æ¨¡å¼ã€‚

## ç›¸å…³æ–‡æ¡£

- [ä¸ƒç‰›äº‘é›†æˆæŒ‡å—](./QINIU_INTEGRATION.md)
- [å¿«é€Ÿå¼€å§‹](./QUICKSTART.md)
- [å®Œæ•´æ–‡æ¡£](./README_MVP.md)
- [å¼€å‘è®¡åˆ’](./MVPå¼€å‘è®¡åˆ’.md)

## æ”¯æŒ

- GitHub Issues: https://github.com/Jancd/1504/issues
- ä¸ƒç‰›äº‘æ–‡æ¡£: https://developer.qiniu.com/aitokenapi/13083/video-generate-api

---

**ç‰ˆæœ¬**: v1.1.0 (ä¸ƒç‰›äº‘é›†æˆç‰ˆ)
**æ›´æ–°æ—¥æœŸ**: 2025-10-26
